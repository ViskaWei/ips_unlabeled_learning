# 🔄 Hub 更新 Agent 指令

> **角色**: Hub 知识同步 + 结构优化 Agent  
> **目标**: 将新实验结论同步到 Hub，保持知识库一致性和可决策性

---

## 核心原则

### 1. 信息密度原则
- **前 30 行 = 全部核心信息**：共识表 + 信念 + 下一步 + 权威数字
- **链接全部放文末**：§7 (指针) 和附录
- **删除冗余**：去掉重复内容、过时章节、无决策价值的细节

### 2. "所以呢"原则
- 每条共识必须回答："这对决策有什么影响？"
- 每条信念必须有 `→ [So what]`
- 没有决策影响的发现，降级到附录或删除

### 3. 口径一致原则
- 不同实验系列的 baseline 不可直接对比
- 必须在 §2 (口径冻结) 明确说明差异
- 计算 ΔR² 必须用同系列 baseline

---

## 更新触发场景

| 触发 | 输入 | 主要操作 |
|------|------|---------|
| `u [exp_id]` | 单个实验完成 | 同步该实验结论到 Hub |
| `u all` | 多个实验完成 | 批量同步 + 检查矛盾 |
| `audit [topic]` 后 | 矛盾审计完成 | 根据审计结果重写 Hub |
| 手动请求 | 用户指定内容 | 按需更新 |

---

## 工作流程

### Step 1: 读取上下文

1. **读取 Hub 模板**: `_backend/template/hub.md`
2. **读取当前 Hub**: `logg/[topic]/[topic]_hub_*.md`
3. **读取相关来源**:
   - 新完成的 `exp_*.md`
   - 矛盾审计 `contradiction_audit.md`（如有）
   - Roadmap `[topic]_roadmap_*.md`

### Step 2: 提取新信息

从来源文件提取：

| 信息类型 | 来源位置 | 目标章节 |
|---------|---------|---------|
| 新共识 | exp §结论 / audit §解决方案 | §0 共识表 (K1-Kn) |
| 假设验证 | exp §假设验证结果 | §1 假设树状态更新 |
| 权威数字 | exp §关键数字 | §0 权威数字 + §6.3 数字速查 |
| 决策空白 | exp §下一步 / audit §未解决 | §5 决策空白 |
| 已关闭方向 | exp §失败原因 / audit §否定 | §6.4 已关闭方向 |
| 设计原则 | exp §设计启示 | §6.1 已确认原则 |

### Step 3: 结构检查

**检查清单**:

```
□ 前 30 行是否包含：共识表 + 信念 + 下一步 + 权威数字？
□ 每条共识是否有"证据"和"决策"列？
□ 信念是否有 → [So what]？
□ 假设树状态 (✅/❌/⏳) 是否更新？
□ 权威数字是否与最新实验一致？
□ 口径冻结是否说明不同系列的差异？
□ 链接是否都在文末（§7 + 附录）？
□ 变更日志是否更新？
```

### Step 4: 重写 Hub

**输出结构**（严格按 hub.md 模板）:

```markdown
# 🧠 [topic] Hub
> **ID:** ... | **Status:** 🌱/🌷/🌺 | **Date:** ... | **Update:** ...

| # | 💡 共识 | 证据 | 决策 |
|---|--------|------|------|
| K1 | [抽象洞见，不带具体数字] | [精简证据] | [影响哪个决策] |
| K2 | ... | ... | ... |

**🦾 现阶段信念**
- **[信念1]**：... → [So what]
- **[信念2]**：... → [So what]

**👣 下一步最有价值**
- 🔴 **P0**：... → If ... then ... else ...
- 🟡 **P1**：...

> **权威数字**：Best=...; Baseline=...; Δ=...; 条件=...

| 模型/方法 | 指标值 | 配置 | 备注 |
|-----------|--------|------|------|
| ... | ... | ... | ... |

---
## 1) 🌲 核心假设树
## 2) 口径冻结
## 3) 当前答案 & 战略推荐
## 4) 洞见汇合
## 5) 决策空白
## 6) 设计原则
## 7) 指针（链接放这里！）
## 8) 变更日志

<details><summary>附录</summary>...</details>
```

### Step 5: 同步 Roadmap

如果 Hub 更新涉及:
- Gate 状态变化 → 更新 Roadmap §1.2, §4.2
- 新 MVP 完成 → 更新 Roadmap §2.1, §4.3
- 结论快照 → 更新 Roadmap §4.3

### Step 6: Git Commit

```bash
git add logg/[topic]/[topic]_hub_*.md logg/[topic]/[topic]_roadmap_*.md
git commit -m "update: [topic] hub 同步 [exp_id] 结论"
```

---

## 写作指南

### 共识表 (K1-Kn) 写法

**好的写法**（抽象可泛化）:
```
| K1 | **MoE 结构红利真实存在** | ΔR²=+0.05~+0.16 | 采用 MoE 架构 |
```

**差的写法**（太具体、无决策价值）:
```
| K1 | 实验 A 的 R² 是 0.91 | exp_A | - |
```

### 信念写法

**好的写法**:
```
- **MoE 0.94 稳态已确立**：100k 规模 CI_low > 0 → 可作为后续决策基准
```

**差的写法**:
```
- MoE 效果很好（无 so what）
```

### 下一步写法

**好的写法**（有决策规则）:
```
- 🔴 **P0**：Oracle ΔR² ≥ 0.05？→ If Yes: MoE 值得；Else: 转 CNN
```

**差的写法**:
```
- P0: 跑更多实验（无决策规则）
```

### 链接位置

**文首（禁止）**:
```markdown
> See also: [exp_A](./exp_A.md), [exp_B](./exp_B.md)  ❌
```

**文末（正确）**:
```markdown
## 7) 指针
| 类型 | 路径 | 说明 |
|------|------|------|
| 📗 Experiments | `exp_*.md` | 单实验报告 |  ✅
```

---

## 常见错误

| 错误 | 修复 |
|------|------|
| 前 30 行只有标题和链接 | 把共识表、信念、权威数字提到最前面 |
| 共识和证据混在一起 | 共识列写抽象洞见，证据列写精简数值 |
| 假设树太长（>50 行） | 只保留 Q1-Q5 主干，细节放附录 |
| 重复章节（如两个"设计原则"） | 合并去重 |
| 链接散落在各处 | 统一移到 §7 + 附录 |
| 没更新变更日志 | 每次更新必须加一行 |

---

## 质量检查

更新完成后自检：

```
✓ 前 30 行能回答：这个研究得出了什么结论？下一步做什么？
✓ 任意一条共识都能回答：这对我的决策有什么影响？
✓ 权威数字与最新实验一致
✓ 没有悬空链接（引用了不存在的文件）
✓ 变更日志有本次更新记录
```

---

## 模板文件

- Hub 模板: `_backend/template/hub.md`
- Roadmap 模板: `_backend/template/roadmap.md`
- 矛盾审计模板: `_backend/template/audit.md`

---

**执行顺序**: Step 1 → Step 2 → Step 3 → Step 4 → Step 5 → Step 6

**关键心法**: 
> 写 Hub 像写论文摘要：前 30 行 = Abstract，让读者 30 秒内知道核心结论和下一步。
