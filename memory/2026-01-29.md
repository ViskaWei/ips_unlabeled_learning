# 2026-01-29 泡泡的项目笔记 🐼

## 对接小胖熊 Vika ✅
- **IPS 研究群 ID**: `-1003762629611`
- **我的 bot**: @Vikalaka_bot (accountId: ips)
- **群里权限**: 可以看到所有消息（不需要 @）
- **协作流程**: 教授 → 小胖熊 → 群里告诉我 → 我执行实验 → git push → 小胖熊汇报
- **创建的文件**:
  - `SYNC_FOR_VIKA.md` - 项目状态总览
  - `PROFESSOR_FEEDBACK.md` - 教授反馈记录

## 理论证明审核 🔍
Viska 指出理论证明有幻觉和拼凑，让我审核。

### 发现的严重问题 ❌
1. **Proposition 2 条件独立性假设是幻觉**
   - 证明假设粒子差条件独立，但有交互时不成立
   - 需改用 mean-field 或 t=0 假设

2. **Theorem 4 Minimax 指数不一致**
   - 定理: `n^{-2(s-1)/(2s+d)}`
   - 证明: `n^{-2(s-1)/(2s+d-2)}`
   - 需要检查哪个正确

3. **Gaussian 积分数值存疑**
   - d=1 验证通过
   - d=2,3 没有完整推导

### 审核报告
- 已写入 `theory/REVIEW_NOTES.md`
- 3 个严重问题，4 个需要细节，3 个正确

### 数学工具调研
- **Lean 4 + mathlib**: 最可靠的形式化证明
- **DeepMind AlphaProof**: 不公开无法使用
- **Claude extended thinking**: 可辅助推理
- **Wolfram Alpha**: 可验证数值计算

## 数学验证执行 ✅ (23:26 EST)
使用了所有可用工具进行严格验证：

### 已创建的验证脚本
1. `theory/verify_minimax.py` - Fano 不等式推导
2. `theory/verify_gaussian_integrals.py` - Gaussian 积分验证
3. `theory/verify_fei_lu_coercivity.py` - 条件方差计算
4. `theory/CORRECTED_THEORY.md` - 修正报告

### 已确认的错误
1. **Thm 4 指数写错**: `2s+d` 应为 `2s+d-2`
2. **Coercivity 常数**: 0.48 无法复现（得到 0.67）
3. **条件独立假设**: 在有交互 IPS 中不成立

### 验证正确的部分
- Lemma 1 (条件独立引理)
- Prop 1 (能量耗散) 
- Thm 1 (Identifiability)
- E[sign·sign] = 1/3 for d=1

---

## 项目概述
**IPS Unlabeled Learning** - 从无标签粒子数据学习交互势函数

### 核心问题
从粒子快照数据（无轨迹标签）学习：
- **Φ (Interaction potential)** - 粒子间交互势
- **V (Kinetic/External potential)** - 外势

### SDE 模型
$$dX_t^i = -\nabla V(X_t^i) dt - \frac{1}{N} \sum_j \nabla \Phi(X_t^i - X_t^j) dt + \sigma dB_t^i$$

---

## Phase 1 总结 (❌ FAIL)
**目标**: 验证 trajectory-free loss (弱形式 PDE)

### 关键发现
| 发现 | 结论 |
|------|------|
| Loss→0 不保证正确解 | V-Φ 可相互抵消 |
| 原论文 loss 公式有误 | 已修正但问题仍存在 |
| 约束方法无效 | V(0)=0, Φ(r_ref)=0 不够 |
| 同时学 V 和 Φ 理论上不可行 | Fei Lu 论文确认 |

### 数字
| 实验 | V Error | Φ Error |
|------|---------|---------|
| Joint V+Φ | 162% | 94% |
| Φ-only | - | 78% |

---

## Phase 2 总结 (⚠️ Identifiability 问题)
**目标**: 实现 Fei Lu 的 error functional 方法

### 关键发现
| 发现 | 结论 |
|------|------|
| Error functional 公式正确 | Oracle test c_opt≈1.0 ✓ |
| PDE solver 需要 semi-implicit | Euler 对 quadratic kernel 不稳定 |
| **Identifiability 问题** | 不同系数组合给相同 φ |
| B-spline 在卷积空间共线 | A 矩阵条件数 ~10^11 |

### 根因
PDE 残差最小 ≠ φ 正确。需要 **RKHS 正则化** 保证唯一解。

---

## 理论推导 (theory/)
已完成的定理：
1. **Proposition 1**: Loss 函数推导（能量耗散）
2. **Theorem 1**: Identifiability（需要 coercivity）
3. **Proposition 2**: Coercivity 充分条件
4. **Theorem 2**: Consistency
5. **Theorem 3**: Convergence rate O(dim(H)/(c_H² n))
6. **Theorem 4**: Minimax lower bound
7. **Theorem 5**: Neural network error bounds

### Coercivity 常数 (Gaussian 分布)
| d | c_H 下界 |
|---|---------|
| 1 | 0.48 |
| 2 | 0.87 |
| 3 | 0.73 |

---

## 下一步建议
| 优先级 | 方向 |
|--------|------|
| P0 | 深入理解 RKHS 正则化如何解决 identifiability |
| P1 | 实现 trajectory-based baseline |
| P2 | 多系统联合学习 |

---

## 关键文件
- `experiments/ips_unlabeled/ips_unlabeled_hub.md` - 项目主文档
- `experiments/ips_unlabeled/ips_unlabeled_roadmap.md` - MVP 追踪
- `theory/` - 理论推导 (LaTeX)
- `experiments/ips_unlabeled/exp/` - 实验报告

---

## 分布式协作 Skill 沉淀
**时间**: 17:20 EST

Viska 要求将分布式 Agent 协作工作流沉淀成 skill：
- **本地端** (mini clawdbot): 短信、合作者对接
- **服务器端** (泡泡): 跑实验、代码执行
- **协调层**: Telegram 群

已创建: `skills/distributed-collab/SKILL.md`

核心设计：
1. 职责分离（通讯 vs 计算）
2. 隐私边界可配置
3. 结构化消息协议
4. 人类可随时介入

---

## 参考论文 (PDF in workspace)
- Fei Lu 系列论文 (identifiability, coercivity, RKHS)
- LED_ips_nn.pdf - 原始论文草稿

---

## 深度验证 Fei Lu 理论 (01:00 EST)

### 使用的工具
- Brave Search API ✅ (搜索论文)
- Web Fetch ✅ (获取 Springer 论文全文)
- SymPy + NumPy ✅ (数值验证)

### 关键发现

**Fei Lu 论文的精确定义 (FoCM 2021)：**
1. 范数: `|||φ||| = ||φ(·)·||_{L²(ρ_T)}`
2. Coercivity: `E[||f_φ(X)||²] ≥ c_H · |||φ|||²`
3. 收敛率: `(log M / M)^{2s/(2s+1)}` (M=轨迹数)

**我们理论中的问题：**
1. c_H 依赖粒子数 N，不是固定值！
   - N=2: c_H=1.00
   - N=5: c_H=0.50
   - N=20: c_H=0.37
2. 我们声称的 0.48 对应大约 N=4-5
3. 收敛率指数在不同上下文有不同含义

**Fei Lu vs 我们的设定：**
| 方面 | Fei Lu | 我们 |
|------|--------|------|
| 数据 | trajectory-based | trajectory-free |
| Loss | MLE (负对数似然) | Energy dissipation |
| 学习目标 | 只学 φ | 学 V 和 Φ |

### 新增验证文件
- `theory/fei_lu_full_verification.py`
- `theory/VERIFIED_THEORY.md`
- `theory/verification_output.txt`
- `theory/FEI_LU_COMPLETE_VERIFICATION.md` (V2)
- `theory/CORRECTIONS_SUMMARY.md`

---

## 🔧 理论修正完成 (02:30 EST)

### 任务1: 追查常数来源 ✅
- 原文公式 `I(1,G₁) = (1/(√3·π))√(2π-6π/5) = √(4/15)` 数学错误！
  - LHS = 0.291, RHS = 0.516
- 正确值: c_H = (2/π)arcsin(1/2) = 1/3 ≈ 0.333

### 任务2: 推导正确收敛率 ✅
- Theorem 5 的 `n^{-2(s-1)/(2s+d-2)}` 是正确的
- 对应 (s-1)-smooth d维梯度估计的 minimax 率

### 任务3: 修正 theoretical_analysis.tex ✅
- 修正 Proposition 4 (Gaussian Coercivity)
- 修正 Proposition 3 的条件独立假设
- 移除错误数值表格
- 添加 Li & Lu (2021) 引用
